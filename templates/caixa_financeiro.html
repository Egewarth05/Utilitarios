{% extends "base.html" %}

{% block title %}TXT → Importação (Resumo das Contas){% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-3">TXT → Importação (Resumo das Contas)</h2>
  <p class="text-muted">Envie o arquivo TXT do caixa e eu gero um TXT pronto para importar (apenas o bloco “Resumo das Contas”).</p>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat, msg in messages %}
        <div class="alert alert-{{ cat }} alert-dismissible fade show" role="alert">
          {{ msg }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="post" enctype="multipart/form-data" class="card p-3 bg-dark border-0">
    <div class="mb-3">
      <label class="form-label">Arquivo TXT</label>
      <input class="form-control" type="file" name="txt_file" accept=".txt" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Separador decimal</label>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="decimal" id="decComma" value="comma" checked>
        <label class="form-check-label" for="decComma">Vírgula (ex.: 1,23)</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="decimal" id="decDot" value="dot">
        <label class="form-check-label" for="decDot">Ponto (ex.: 1.23)</label>
      </div>
    </div>

    <button class="btn btn-primary" type="submit">
      <i class="fa-solid fa-wand-magic-sparkles me-1"></i> Gerar TXT de Importação
    </button>
  </form>

  {% if resultado %}
    <hr class="my-4">
    <h5>Resultado</h5>
    <p>Linhas processadas: <strong>{{ resultado.linhas }}</strong></p>
    <a class="btn btn-success" href="{{ url_for('download_resumo_contas', filename=resultado.filename) }}">
      <i class="fa-solid fa-download me-1"></i> Baixar TXT de Importação
    </a>
  {% endif %}
</div>
{% endblock %}
